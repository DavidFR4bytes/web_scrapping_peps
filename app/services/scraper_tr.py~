import requests
from bs4 import BeautifulSoup
import json
import os


def scrape_peps_turkey():
    base_url = "https://www.tbmm.gov.tr"
    url = base_url + "/milletvekilleri/AllList"
    headers = {"User-Agent": "Mozilla/5.0"}

    response = requests.get(url, headers=headers)
    if response.status_code != 200:
        print("Error al acceder a la página:", response.status_code)
        return

    soup = BeautifulSoup(response.content, "html.parser")
    peps = []

    # Recorrer cada bloque de provincias
    for ul in soup.find_all("ul", class_="tbmm-list-ul"):
        current_province = None

        for li in ul.find_all("li", class_="list-group-item"):
            # Identificar encabezado de provincia
            if "tbmm-list-item-active" in li.get("class", []):
                current_province = li.get_text(strip=True)
                continue

            # Extraer datos de cada diputado
            name_tag = li.find("a")
            party_tag = li.find("div", class_="col-md-4")

            name = name_tag.get_text(strip=True) if name_tag else ""
            link = base_url + name_tag["href"] if name_tag and name_tag.has_attr("href") else ""
            party = party_tag.get_text(strip=True) if party_tag else ""

            peps.append({
                "nombre": name,
                "partido": party,
                "provincia": current_province,
                "url_biografia": link
            })

    # Guardar resultados en archivo JSON
    os.makedirs("data", exist_ok=True)
    with open("data/peps_turkey.json", "w", encoding="utf-8") as f:
        json.dump(peps, f, ensure_ascii=False, indent=4)

    print(f"{len(peps)} PEPs de Turquía guardadas en data/peps_turkey.json")


# Ejecutar el scraper
scrape_peps_turkey()
